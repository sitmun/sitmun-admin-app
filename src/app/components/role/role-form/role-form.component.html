<app-form-toolbar
  icon="menu_rol"
  entityType="roleEntity.role"
  [itemName]="formRole.get('name')?.value"
  [isNew]="roleID === -1"
  (save)="onSaveButtonClicked()"
  (back)="utils.navigateBack()">
</app-form-toolbar>

<mat-tab-group
  mat-stretch-tabs="false"
  mat-align-tabs="end"
  [dynamicHeight]="true"
  preserveContent="true"
  (selectedTabChange)="onTabChange($event)">
  >
  <mat-tab label="{{ 'roleEntity.generalData' | translate }}">
    <mat-card appearance="outlined">
      <mat-card-content>
        <form [formGroup]='formRole'>
          <mat-form-field appearance="outline" class="full">
            <mat-label>{{ 'roleEntity.name' | translate }}</mat-label>
            <input matInput type="text" formControlName="name" required>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full">
            <mat-label>{{ 'roleEntity.note' | translate }}</mat-label>
            <textarea matInput type="text" formControlName="description"></textarea>
          </mat-form-field>
        </form>
      </mat-card-content>
    </mat-card>
  </mat-tab>
  <mat-tab label="{{ 'roleEntity.permissions' | translate }}">
    <app-data-grid [changeHeightButton]="true"
                   [columnDefs]="columnDefsUsers"
                   [getAll]='getAllUsers'
                   [addFieldRestriction]="['territoryId', 'roleId', 'userId']"
                   [eventAddItemsSubscription]='addElementsEventUsers.asObservable()'
                   [eventGetAllRowsSubscription]='getAllElementsEventUsers.asObservable()'
                   [eventRefreshSubscription]='dataUpdatedEventUsers.asObservable()'
                   [discardChangesButton]=true
                   [redoButton]=true
                   [undoButton]=true
                   [deleteButton]=true
                   [addButton]=true
                   [hideDuplicateButton]=true
                   [actionButton]=true
                   (add)="openUsersDialog($event)"
                   (getAllRows)="getAllRowsUsers($event)"
                   [redraw]="activeTabIndex === 1"
                   *ngIf="dataLoaded"
    ></app-data-grid>
  </mat-tab>
  <mat-tab label="{{ 'roleEntity.permissiongroupLayersConfiguration' | translate }}">
    <app-data-grid [changeHeightButton]="true"
                   [allNewElements]="roleID === -1"
                   [defaultColumnSorting]="['name']"
                   [columnDefs]="columnDefsCartography"
                   [getAll]='getAllCartographiesGroups'
                   [eventAddItemsSubscription]='addElementsEventCartographies.asObservable()'
                   [eventGetAllRowsSubscription]='getAllElementsEventCartographies.asObservable()'
                   [discardChangesButton]=true
                   [redoButton]=true
                   [undoButton]=true
                   [deleteButton]=true
                   [addButton]=true
                   [eventRefreshSubscription]='dataUpdatedEventCartographies.asObservable()'
                   [hideDuplicateButton]=true
                   [actionButton]=true
                   (add)="openCartographyDialog($event)"
                   (getAllRows)="getAllRowsCartographiesGroups($event)"
                   [redraw]="activeTabIndex === 2"
                   *ngIf="dataLoaded"
    ></app-data-grid>
  </mat-tab>
  <mat-tab label="{{ 'roleEntity.tasks' | translate }}">
    <app-data-grid [changeHeightButton]="true"
                   [allNewElements]="roleID === -1"
                   [columnDefs]="columnDefsTasks"
                   [defaultColumnSorting]="['groupName']"
                   [getAll]='getAllTasks'
                   [eventAddItemsSubscription]='addElementsEventTasks.asObservable()'
                   [eventGetAllRowsSubscription]='getAllElementsEventTasks.asObservable()'
                   [discardChangesButton]=true
                   [redoButton]=true
                   [undoButton]=true
                   [deleteButton]=true
                   [addButton]=true
                   [eventRefreshSubscription]='dataUpdatedEventTasks.asObservable()'
                   [hideDuplicateButton]=true
                   [actionButton]=true (add)="openTasksDialog($event)"
                   (getAllRows)="getAllRowsTasks($event)"
                   [redraw]="activeTabIndex === 3"
                   *ngIf="dataLoaded"
    ></app-data-grid>
  </mat-tab>
  <mat-tab label="{{ 'roleEntity.applications' | translate }}">
    <app-data-grid [changeHeightButton]="true"
                   [allNewElements]="roleID === -1"
                   [defaultColumnSorting]="['name']"
                   [columnDefs]="columnDefsApplications"
                   [getAll]='getAllApplications'
                   [eventAddItemsSubscription]='addElementsEventApplications.asObservable()'
                   [eventGetAllRowsSubscription]='getAllElementsEventApplications.asObservable()'
                   [discardChangesButton]=true
                   [redoButton]=true
                   [undoButton]=true
                   [deleteButton]=true
                   [addButton]=true
                   [eventRefreshSubscription]='dataUpdatedEventApplications.asObservable()'
                   [hideDuplicateButton]=true
                   [actionButton]=true
                   (add)="openApplicationsDialog($event)"
                   (getAllRows)="getAllRowsApplications($event)"
                   [redraw]="activeTabIndex === 4"
                   *ngIf="dataLoaded"
    ></app-data-grid>
  </mat-tab>
</mat-tab-group>
