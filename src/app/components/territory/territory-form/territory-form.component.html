<app-form-toolbar
  entityType="{{ config.labelSingular }}"
  font="{{ config.font }}"
  icon="{{ config.icon }}"
  [isNew]="isNewOrDuplicated()"
  [itemName]="itemName('name')"
  (save)="onSaveButtonClicked()"
  (back)="utils.navigateBack()">
</app-form-toolbar>
<mat-tab-group
  mat-stretch-tabs="false"
  mat-align-tabs="end"
  [dynamicHeight]="true"
  preserveContent="true">
  <mat-tab label="{{ 'common.form.details' | translate }}">
    <form *ngIf="dataLoaded" [formGroup]='entityForm'>
      <mat-card class="sitmun-mat-card-margin" appearance="outlined">
        <mat-card-content>
          <mat-form-field appearance="outline" class="full">
            <mat-label>{{ 'entity.territory.name' | translate }}</mat-label>
            <input matInput type="text" formControlName="name">
            <mat-icon matSuffix class="iconTranslate"
                      (click)="onTranslated('name')"
                      onKeyDown="onTranslated('name')"
                      svgIcon="ic_translate"></mat-icon>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full">
            <mat-label>{{ 'entity.territory.description' | translate }}</mat-label>
            <textarea
              matInput
              formControlName="description"
              rows="2"
            ></textarea>
            <mat-icon matSuffix class="iconTranslate"
                      (click)="onTranslated('description')"
                      onKeyDown="onTranslated('description')"
                      svgIcon="ic_translate"></mat-icon>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full">
            <mat-label>{{ 'entity.territory.address' | translate }}</mat-label>
            <textarea
              matInput
              formControlName="territorialAuthorityAddress"
              rows="2"
            ></textarea>
          </mat-form-field>
          <mat-form-field appearance="outline" class="quarter add-gap">
            <mat-label>
              {{ 'entity.territory.territoryType' | translate }}
            </mat-label>
            <mat-select class="form-control" formControlName="typeId"
                        (selectionChange)="onTerritoryTypeChanged($event)">
              <mat-option [value]="territoryType.id" *ngFor="let territoryType of territoryTypes">
                {{ territoryType.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field appearance="outline" class="quarter add-gap">
            <mat-label>{{ 'entity.territory.code' | translate }}</mat-label>
            <input matInput type="text" formControlName="code" maxlength="10" required>
          </mat-form-field>
          <mat-checkbox formControlName="blocked">
            {{ 'entity.territory.blocked' | translate }}
          </mat-checkbox>
          <div class="break"></div>
          <mat-form-field appearance="outline" class="full">
            <mat-label>{{ 'entity.territory.logo' | translate }}</mat-label>
            <input matInput type="text" formControlName="territorialAuthorityLogo">
          </mat-form-field>
          <mat-form-field appearance="outline" class="quarter">
            <mat-label>{{ 'entity.territory.defaultZoomLevel' | translate }}</mat-label>
            <input matInput type="number" formControlName="defaultZoomLevel">
          </mat-form-field>
          <div class="break"></div>
          <mat-form-field appearance="outline" class="quarter add-gap">
            <mat-label>{{ 'entity.territory.centerPointX' | translate }}</mat-label>
            <input matInput type="number" formControlName="centerPointX">
          </mat-form-field>
          <mat-form-field appearance="outline" class="quarter">
            <mat-label>{{ 'entity.territory.centerPointY' | translate }}</mat-label>
            <input matInput type="number" formControlName="centerPointY">
          </mat-form-field>
          <div class="break"></div>
          <mat-form-field appearance="outline" class="quarter add-gap">
            <mat-label>{{ 'entity.territory.extentMinX' | translate }}</mat-label>
            <input matInput type="number" formControlName="extentMinX" required>
          </mat-form-field>
          <mat-form-field appearance="outline" class="quarter add-gap">
            <mat-label>{{ 'entity.territory.extentMaxX' | translate }}</mat-label>
            <input matInput type="number" formControlName="extentMaxX" required>
          </mat-form-field>
          <mat-form-field appearance="outline" class="quarter add-gap">
            <mat-label>{{ 'entity.territory.extentMinY' | translate }}</mat-label>
            <input matInput type="number" formControlName="extentMinY" required>
          </mat-form-field>
          <mat-form-field appearance="outline" class="quarter">
            <mat-label>{{ 'entity.territory.extentMaxY' | translate }}</mat-label>
            <input matInput type="number" formControlName="extentMaxY" required>
          </mat-form-field>
          <mat-form-field appearance="outline" class="quarter">
            <mat-label>{{ 'applicationEntity.srs' | translate }}</mat-label>
            <input matInput type="text" title="{{ 'projectionMessage' | translate }}" formControlName="srs">
          </mat-form-field>

          <mat-form-field appearance="outline" class="full">
            <mat-label>{{ 'entity.territory.note' | translate }}</mat-label>
            <textarea
              matInput
              formControlName="note"
              rows="2"
            ></textarea>
          </mat-form-field>
        </mat-card-content>
      </mat-card>
    </form>
  </mat-tab>
  <mat-tab label="{{'entity.territory.permissions.header' | translate }}">
    <mat-card appearance="outlined" class="sitmun-mat-card-margin">
      <mat-card-content>
        <app-data-grid (add)="permitsTable.openDialog($event)"
                       (getAllRows)="permitsTable.handleSaveRelations($event)"
                       *ngIf="dataLoaded"
                       [actionButton]=true
                       [addButton]=true
                       [allNewElements]="isNewOrDuplicated()"
                       [changeHeightButton]="true"
                       [columnDefs]="permitsTable.relationsColumnsDefs"
                       [defaultColumnSorting]='permitsTable.defaultRelationsSorting()'
                       [deleteButton]=true
                       [discardChangesButton]=true
                       [eventAddItemsSubscription]='permitsTable.addCommandEvent$.asObservable()'
                       [eventGetAllRowsSubscription]='permitsTable.saveCommandEvent$.asObservable()'
                       [eventRefreshSubscription]='permitsTable.refreshCommandEvent$.asObservable()'
                       [getAll]='permitsTable.relationsFetchFn'
                       [hideDuplicateButton]=true
                       [hideReplaceButton]=true
                       [redoButton]=true
                       [undoButton]=true>
        </app-data-grid>
      </mat-card-content>
    </mat-card>
  </mat-tab>
  <mat-tab *ngIf="!currentTypeTop" label="{{'entity.territory.memberOfTerritories.header' | translate }}">
    <mat-card appearance="outlined" class="sitmun-mat-card-margin">
      <mat-card-content>
        <app-data-grid (add)="membersOfTable.openDialog($event)"
                       (getAllRows)="membersOfTable.handleSaveRelations($event)"
                       *ngIf="dataLoaded"
                       [actionButton]=true
                       [addButton]=true
                       [allNewElements]="isNewOrDuplicated()"
                       [changeHeightButton]="true"
                       [columnDefs]="membersOfTable.relationsColumnsDefs"
                       [defaultColumnSorting]='membersOfTable.defaultRelationsSorting()'
                       [deleteButton]=true
                       [discardChangesButton]=true
                       [eventAddItemsSubscription]='membersOfTable.addCommandEvent$.asObservable()'
                       [eventGetAllRowsSubscription]='membersOfTable.saveCommandEvent$.asObservable()'
                       [eventRefreshSubscription]='membersOfTable.refreshCommandEvent$.asObservable()'
                       [getAll]='membersOfTable.relationsFetchFn'
                       [hideDuplicateButton]=true
                       [hideReplaceButton]=true
                       [redoButton]=true
                       [undoButton]=true>
        </app-data-grid>
      </mat-card-content>
    </mat-card>
  </mat-tab>
  <mat-tab *ngIf="!currentTypeBottom" label="{{'entity.territory.members.header' | translate }}">
    <mat-card appearance="outlined" class="sitmun-mat-card-margin">
      <mat-card-content>
        <app-data-grid (add)="membersTable.openDialog($event)"
                       (getAllRows)="membersTable.handleSaveRelations($event)"
                       *ngIf="dataLoaded"
                       [actionButton]=true
                       [addButton]=true
                       [allNewElements]="isNewOrDuplicated()"
                       [changeHeightButton]="true"
                       [columnDefs]="membersTable.relationsColumnsDefs"
                       [defaultColumnSorting]='membersTable.defaultRelationsSorting()'
                       [deleteButton]=true
                       [discardChangesButton]=true
                       [eventAddItemsSubscription]='membersTable.addCommandEvent$.asObservable()'
                       [eventGetAllRowsSubscription]='membersTable.saveCommandEvent$.asObservable()'
                       [eventRefreshSubscription]='membersTable.refreshCommandEvent$.asObservable()'
                       [getAll]='membersTable.relationsFetchFn'
                       [hideDuplicateButton]=true
                       [hideReplaceButton]=true
                       [redoButton]=true
                       [undoButton]=true>
        </app-data-grid>
      </mat-card-content>
    </mat-card>
  </mat-tab>
  <mat-tab label="{{'entity.territory.cartography.header' | translate }}">
    <mat-card appearance="outlined" class="sitmun-mat-card-margin">
      <mat-card-content>
        <app-data-grid (add)="cartographiesTable.openDialog($event)"
                       (getAllRows)="cartographiesTable.handleSaveRelations($event)"
                       *ngIf="dataLoaded"
                       [actionButton]=true
                       [addButton]=true
                       [allNewElements]="isNewOrDuplicated()"
                       [changeHeightButton]="true"
                       [columnDefs]="cartographiesTable.relationsColumnsDefs"
                       [defaultColumnSorting]='cartographiesTable.defaultRelationsSorting()'
                       [deleteButton]=true
                       [discardChangesButton]=true
                       [eventAddItemsSubscription]='cartographiesTable.addCommandEvent$.asObservable()'
                       [eventGetAllRowsSubscription]='cartographiesTable.saveCommandEvent$.asObservable()'
                       [eventRefreshSubscription]='cartographiesTable.refreshCommandEvent$.asObservable()'
                       [getAll]='cartographiesTable.relationsFetchFn'
                       [hideDuplicateButton]=true
                       [hideReplaceButton]=true
                       [redoButton]=true
                       [undoButton]=true>
        </app-data-grid>
      </mat-card-content>
    </mat-card>
  </mat-tab>
  <mat-tab label="{{'entity.territory.tasks.header' | translate }}">
    <mat-card appearance="outlined" class="sitmun-mat-card-margin">
      <mat-card-content>
        <app-data-grid (add)="tasksTable.openDialog($event)"
                       (getAllRows)="tasksTable.handleSaveRelations($event)"
                       *ngIf="dataLoaded"
                       [actionButton]=true
                       [addButton]=true
                       [allNewElements]="isNewOrDuplicated()"
                       [changeHeightButton]="true"
                       [columnDefs]="tasksTable.relationsColumnsDefs"
                       [defaultColumnSorting]='tasksTable.defaultRelationsSorting()'
                       [deleteButton]=true
                       [discardChangesButton]=true
                       [eventAddItemsSubscription]='tasksTable.addCommandEvent$.asObservable()'
                       [eventGetAllRowsSubscription]='tasksTable.saveCommandEvent$.asObservable()'
                       [eventRefreshSubscription]='tasksTable.refreshCommandEvent$.asObservable()'
                       [getAll]='tasksTable.relationsFetchFn'
                       [hideDuplicateButton]=true
                       [hideReplaceButton]=true
                       [redoButton]=true
                       [undoButton]=true>
        </app-data-grid>
      </mat-card-content>
    </mat-card>
  </mat-tab>
</mat-tab-group>
