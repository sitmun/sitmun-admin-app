!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports,require("@angular/core"),require("@ag-grid-community/all-modules"),require("@angular/forms"),require("@angular/common"),require("@angular/common/http"),require("@angular/platform-browser/animations"),require("@angular/router"),require("@ngx-translate/core"),require("@sitmun/frontend-core"),require("@ag-grid-community/angular"),require("@angular/material/button"),require("@angular/material/icon")):"function"==typeof define&&define.amd?define("@sitmun/frontend-gui",["exports","@angular/core","@ag-grid-community/all-modules","@angular/forms","@angular/common","@angular/common/http","@angular/platform-browser/animations","@angular/router","@ngx-translate/core","@sitmun/frontend-core","@ag-grid-community/angular","@angular/material/button","@angular/material/icon"],o):o((t.sitmun=t.sitmun||{},t.sitmun["frontend-gui"]={}),t.ng.core,null,t.ng.forms,t.ng.common,t.ng.common.http,t.ng.platformBrowser.animations,t.ng.router,null,null,null,t.ng.material.button,t.ng.material.icon)}(this,function(t,o,e,n,i,r,a,l,d,s,u,c,p){"use strict";function m(t){var o="function"==typeof Symbol&&t[Symbol.iterator],e=0;return o?o.call(t):{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}}}var g=(h.prototype.onGridReady=function(t){this.params=t,this.gridApi=t.api,this.gridColumnApi=t.columnApi,this.getElements(),this.gridApi.sizeColumnsToFit();try{for(var o=m(this.columnDefs),e=o.next();!e.done;e=o.next())"estat"===e.value.field&&(this.columnaEstat=!0)}catch(r){n={error:r}}finally{try{e&&!e.done&&(i=o["return"])&&i.call(o)}finally{if(n)throw n.error}}var n,i},h.prototype.quickSearch=function(){this.gridApi.setQuickFilter(this.searchValue)},h.prototype.getElements=function(){var o=this;this.getAll().subscribe(function(t){console.log(t),o.rowData=t,setTimeout(function(){o.gridApi.sizeColumnsToFit()},30)})},h.prototype.removeData=function(){this.gridApi.stopEditing(!1);var t,o,e=this.gridApi.getSelectedNodes(),n=e.map(function(t){return t.data});if(this.remove.emit(n),this.columnaEstat){var i=e.map(function(t){return t.rowIndex});try{for(var r=m(i),a=r.next();!a.done;a=r.next()){var l=a.value;this.gridApi.getRowNode(l).data.estat="Eliminat"}}catch(d){t={error:d}}finally{try{a&&!a.done&&(o=r["return"])&&o.call(r)}finally{if(t)throw t.error}}this.gridOptions.api.refreshCells()}this.gridOptions.api.deselectAll()},h.prototype.newData=function(){this.gridApi.stopEditing(!1),this["new"].emit(!0)},h.prototype.applyChanges=function(){var t,o,e=[];this.gridApi.stopEditing(!1);try{for(var n=m(this.map.keys()),i=n.next();!i.done;i=n.next()){var r=i.value;e.push(this.gridApi.getRowNode(r).data)}}catch(a){t={error:a}}finally{try{i&&!i.done&&(o=n["return"])&&o.call(n)}finally{if(t)throw t.error}}this.sendChanges.emit(e),this.map.clear(),this.comptadorCanvis=0,this.comptadorCanvisAnterior=0,this.comptadorRedo=0,this.params.colDef.cellStyle={backgroundColor:"#FFFFFF"},this.gridApi.redrawRows()},h.prototype.deleteChanges=function(){for(var t=0;t<this.comptadorCanvis;t++)this.gridApi.undoCellEditing();this.map.clear(),this.comptadorCanvisAnterior=0,this.comptadorCanvis=0,this.comptadorRedo=0,this.params.colDef.cellStyle={backgroundColor:"#FFFFFF"},this.gridApi.redrawRows()},h.prototype.onFilterModified=function(){this.deleteChanges()},h.prototype.undo=function(){this.gridApi.stopEditing(!1),this.gridApi.undoCellEditing(),--this.comptadorCanvis,this.comptadorRedo+=1},h.prototype.redo=function(){this.gridApi.stopEditing(!1),this.gridApi.redoCellEditing(),this.comptadorCanvis+=1,--this.comptadorRedo},h.prototype.onCellEditingStopped=function(t){this.canviAmbModificacions&&(this.comptadorCanvis++,this.comptadorRedo=0,this.onCellValueChanged(t),this.canviAmbModificacions=!1)},h.prototype.onCellValueChanged=function(t){var o,e;this.params=t,this.comptadorCanvis>this.comptadorCanvisAnterior?t.oldValue===t.value||null==t.oldValue&&""===t.value||(this.map.has(t.node.id)?(o=this.map.get(t.node.id),this.map.set(t.node.id,o+1)):this.map.set(t.node.id,1),e=this.gridApi.getDisplayedRowAtIndex(t.rowIndex),t.colDef.cellStyle={backgroundColor:"#E8F1DE"},this.gridApi.redrawRows({rowNodes:[e]}),t.colDef.cellStyle={backgroundColor:"#FFFFFF"},this.comptadorCanvisAnterior++):this.comptadorCanvis<this.comptadorCanvisAnterior?(1===(o=this.map.get(t.node.id))?(this.map["delete"](t.node.id),e=this.gridApi.getDisplayedRowAtIndex(t.rowIndex),t.colDef.cellStyle={backgroundColor:"#FFFFFF"},this.gridApi.redrawRows({rowNodes:[e]})):1<o&&(this.map.set(t.node.id,o-1),e=this.gridApi.getDisplayedRowAtIndex(t.rowIndex),t.colDef.cellStyle={backgroundColor:"#E8F1DE"},this.gridApi.redrawRows({rowNodes:[e]}),t.colDef.cellStyle={backgroundColor:"#FFFFFF"}),this.comptadorCanvisAnterior--):(console.log(t),t.oldValue===t.value||null==t.oldValue&&""===t.value?this.map.has(t.node.id)?(e=this.gridApi.getDisplayedRowAtIndex(t.rowIndex),t.colDef.cellStyle={backgroundColor:"#E8F1DE"},this.gridApi.redrawRows({rowNodes:[e]}),t.colDef.cellStyle={backgroundColor:"#FFFFFF"}):(this.comptadorCanvisAnterior++,this.gridApi.undoCellEditing()):this.canviAmbModificacions=!0)},h.decorators=[{type:o.Component,args:[{selector:"app-data-grid",template:'\n\n\n    <div id=grup1 >\n        <button  mat-mini-fab *ngIf="botoDescartarCanvis"  id="borrarCanvis" type="button"  (click)="deleteChanges()" [disabled]="comptadorCanvis <= 0">\n            <mat-icon fontSet="material-icons-round" > close </mat-icon>\n        </button>\n        <button mat-mini-fab *ngIf="botoUndo"  id="undo"  (click)="undo()" [disabled]="comptadorCanvis <= 0" >\n            <mat-icon fontSet="material-icons-round" > undo </mat-icon>\n        </button>\n        <button mat-mini-fab *ngIf="botoRedo"  id="redo"  (click)="redo()" [disabled]="comptadorRedo <= 0">\n            <mat-icon fontSet="material-icons-round" > redo </mat-icon>\n        </button>\n        <button mat-mini-fab  *ngIf="botoAplicarCanvis"  id="aplicarCanvis"  (click)="applyChanges()" [disabled]="comptadorCanvis <= 0" >\n            <mat-icon fontSet="material-icons-round" > check </mat-icon>\n        </button>\n    </div>\n\n    <div id=grup2 >\n        <label *ngIf="searchGeneral" >Search </label>\n        <input *ngIf="searchGeneral"type="text" placeholder="" (keyup)="quickSearch()" [(ngModel)]="searchValue" ml-2 >\n        <button *ngIf="botoElimina"  mat-stroked-button id="botoElimina"  (click)="removeData()">\n            <mat-icon fontSet="material-icons-round" > delete </mat-icon>\n            Elimina\n        </button>\n        <button  *ngIf="botoNou" mat-stroked-button id="botoNou"  (click)="newData()">\n            <mat-icon fontSet="material-icons-round"> add_circle_outline </mat-icon>                 \n            Nou\n        </button>\n\n\n        \n    </div>\n\n\n\n    <div class="row" style=" height: 100%">\n        <div class="ag-theme-balham" id="myGrid" style=" width:100%; height: 100%" >\n            <ag-grid-angular\n            style=" width: 100%; height: 100%;"\n            class="ag-theme-balham"\n            [floatingFilter]="true"\n            [rowData]="rowData"\n            [columnDefs]="columnDefs"\n            [gridOptions]="gridOptions"\n            [animateRows]="true"\n            [pagination]="false"\n            [modules]="modules"     \n            [undoRedoCellEditing]="true"    \n            [undoRedoCellEditingLimit]= 200\n            [suppressRowClickSelection]=true\n            [enableCellChangeFlash]=true\n            rowSelection="multiple"\n            (filterModified)="onFilterModified()"\n            (cellEditingStopped) ="onCellEditingStopped($event)"\n            (cellValueChanged)="onCellValueChanged($event)"\n            (gridReady)="onGridReady($event)">\n            \n            </ag-grid-angular>\n        </div>\n    </div>\n\n\n',styles:["input,label{display:inline-block;margin:5px 5px 5px 10px}#botoNou{color:#fff;background:no-repeat padding-box #68a225;margin-left:3px}#botoElimina{background:no-repeat padding-box #fff;margin-left:3px}#aplicarCanvis{color:#fff!important;background:no-repeat padding-box #68a225;margin-left:3px}#aplicarCanvis[disabled]{background:no-repeat padding-box #83976c}#redo,#undo{color:#fff!important;background:#ff9300;margin-left:3px}#redo[disabled],#undo[disabled]{background:#ffc97f;margin-left:3px}#borrarCanvis{color:#fff!important;background:#df3133}#borrarCanvis[disabled]{color:#fff!important;background:#da8c8e}#grup1{text-align:start;width:40%}#grup2{text-align:end;width:60%}#grup1,#grup2{display:inline-block!important}"]}]}],h.ctorParameters=function(){return[]},h.propDecorators={columnDefs:[{type:o.Input}],getAll:[{type:o.Input}],botoDescartarCanvis:[{type:o.Input}],botoUndo:[{type:o.Input}],botoRedo:[{type:o.Input}],botoAplicarCanvis:[{type:o.Input}],botoElimina:[{type:o.Input}],botoNou:[{type:o.Input}],searchGeneral:[{type:o.Input}],remove:[{type:o.Output}],"new":[{type:o.Output}],sendChanges:[{type:o.Output}]},h);function h(){this.modules=e.AllCommunityModules,this.columnaEstat=!1,this.map=new Map,this.canviAmbModificacions=!1,this.remove=new o.EventEmitter,this["new"]=new o.EventEmitter,this.sendChanges=new o.EventEmitter,this.comptadorCanvis=0,this.comptadorCanvisAnterior=0,this.comptadorRedo=0,this.gridOptions={defaultColDef:{flex:1,filter:!0,editable:!0,cellStyle:{backgroundColor:"#FFFFFF"}},rowSelection:"multiple"}}f.decorators=[{type:o.NgModule,args:[{imports:[l.RouterModule,r.HttpClientModule,i.CommonModule,n.FormsModule,a.NoopAnimationsModule,s.AngularHalModule,n.ReactiveFormsModule,a.BrowserAnimationsModule,u.AgGridModule.withComponents([]),s.SitmunFrontendCoreModule,c.MatButtonModule,p.MatIconModule],declarations:[g],entryComponents:[],providers:[],exports:[r.HttpClientModule,i.CommonModule,n.FormsModule,a.NoopAnimationsModule,s.AngularHalModule,d.TranslateModule,n.ReactiveFormsModule,g,s.SitmunFrontendCoreModule]}]}],s=f;function f(){}t.DataGridComponent=g,t.SitmunFrontendGuiModule=s,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=sitmun-frontend-gui.umd.min.js.map